<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>도둑잡기 2인 게임</title>
<style>
  body {
    margin: 0;
    background: url('background.jpg') center/cover no-repeat fixed;
    overflow: hidden;
  }

  #gameArea {
    position: relative;
    width: 100vw;
    height: 100vh;
  }

  /* 플레이어 카드 (조금 더 큼) */
  .playerCard {
    position: absolute;
    width: 132px;
    height: 186px;
    border-radius: 10px;
    cursor: pointer;
    box-shadow: 0 6px 14px rgba(0,0,0,0.4);
    transition: all 0.25s ease;
  }

  /* AI 카드 (더 작음) */
  .aiCard {
    position: absolute;
    width: 90px;
    height: 130px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.35);
    transition: all 0.25s ease;
  }

  /* 중앙 스택 (가로로 쌓임) */
  #centerStack {
    position: absolute;
    width: 380px;
    height: 180px;
    left: 30%;
    top: 50%;
    transform: translate(-50%, -50%);
  }

  .stackCard {
    position: absolute;
    width: 110px;
    height: 155px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  }

 #playButton {
  position: absolute;
  right: 200px;
  bottom: 200px;

  width: 50px;     /* 원래보다 작게 */
  height: 120px;   /* 비율 유지하면서 줄임 */

  border-radius: 12px;

  background-image: url('내기.png');
  background-size: contain;      /* 이미지 안 잘리고 들어감 */
  background-position: center;
  background-repeat: no-repeat;

  cursor: pointer;
  transition: transform 0.2s;
}
#playButton:hover { transform: scale(1.08); }

  #endMessage {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%,-50%);
    color: #fff;
    font-size: 48px;
    font-weight: bold;
    text-shadow: 0 4px 12px rgba(0,0,0,0.6);
  }
</style>
</head>
<body>

<div id="gameArea">
  <div id="centerStack"></div>
  <div id="playButton"></div>
  <div id="endMessage"></div>
</div>

<script>
/* -----------------------------
   카드 준비
------------------------------ */
const suits = ["c","d","h","s"];
const cards = [];

// 1~10 * 4종류 → 40장
for (let s of suits) {
  for (let n = 1; n <= 10; n++) {
    cards.push({
      id: `${s}_${n}`,
      suit: s,
      num: n,
      isJoker: false,
      file: `cards/${s}_${n}.jpg`
    });
  }
}

// 조커 1장
cards.push({
  id: "JOKER",
  suit: "joker",
  num: 0,
  isJoker: true,
  file: "cards/JOKER.jpg"
});

// 섞기
cards.sort(() => Math.random() - 0.5);

// 반으로 나누기 (21장 & 20장)
let player = cards.slice(0, 21);
let ai = cards.slice(21);

const gameArea = document.getElementById("gameArea");
let centerStack = [];       // 중앙에 누적되는 카드들
let selected = [];          // 플레이어가 선택한 카드들
let lastPlayerStealTime = null;

/* -----------------------------
   카드 만들기
------------------------------ */
function createCard(card, owner, x, y) {
  const div = document.createElement("img");
  div.dataset.id = card.id;

  // owner에 따라 크기 다르게
  if (owner === "player") {
    div.className = "playerCard";
    div.src = card.file;
  } else if (owner === "ai") {
    div.className = "aiCard";
    div.src = "cards/BACK.PNG";
  }

  div.style.left = x + "px";
  div.style.top = y + "px";

  div.onclick = () => {
    if (owner === "player") selectPlayerCard(card, div);
    else stealFromAI(card);
  };

  gameArea.appendChild(div);
}

/* -----------------------------
   렌더링
------------------------------ */
function render() {
  gameArea.innerHTML =
    '<div id="centerStack"></div>' +
    '<div id="playButton"></div>' +
    '<div id="endMessage"></div>';

  const center = document.getElementById("centerStack");
  const playButton = document.getElementById("playButton");

  playButton.onclick = tryPlayCards;

  const w = window.innerWidth;
  const h = window.innerHeight;

  /* --- player row --- */
  let pStart = w/2 - (player.length * 55) / 2;
  player.forEach((card, i) => {
    createCard(card, "player", pStart + i * 55, h - 200);
  });

  /* --- AI row --- */
  let aStart = w/2 - (ai.length * 45) / 2;
  ai.forEach((card, i) => {
    createCard(card, "ai", aStart + i * 45, 40);
  });

  /* --- 중앙 스택: 가로로 겹쳐 쌓기 --- */
  centerStack.forEach((card, i) => {
    const img = document.createElement("img");
    img.className = "stackCard";
    img.src = card.file;
    img.style.left = (i * 25) + "px";
    img.style.top = "0px";
    center.appendChild(img);
  });

  checkGameEnd();
}

/* -----------------------------
   게임 종료
------------------------------ */
function checkGameEnd() {
  if (player.length === 0 && ai.length === 0) {
    const msg = document.getElementById("endMessage");

    const playerHasJoker = player.some(c => c.isJoker);
    const aiHasJoker = ai.some(c => c.isJoker);

    if (playerHasJoker) msg.innerText = "패배... (조커 보유)";
    else if (aiHasJoker) msg.innerText = "승리! (AI가 조커 보유)";
    else msg.innerText = "무승부?";
  }
}

/* -----------------------------
   플레이어 카드 선택
------------------------------ */
function selectPlayerCard(card, div) {
  if (card.isJoker) return;

  const exists = selected.find(s => s.card.id === card.id);

  if (exists) {
    // 선택 해제
    selected = selected.filter(s => s.card.id !== card.id);
    div.style.transform = "translateY(0)";
  } else {
    if (selected.length >= 2) return;
    selected.push({card, div});
    div.style.transform = "translateY(-25px)";
  }
}

/* -----------------------------
   “내기” 버튼 눌렀을 때 처리
------------------------------ */
function tryPlayCards() {
  if (selected.length !== 2) return;

  const [a, b] = selected;

  if (a.card.num !== b.card.num || a.card.isJoker || b.card.isJoker) {
    // 되돌리기
    a.div.style.transform = "translateY(0)";
    b.div.style.transform = "translateY(0)";
    selected = [];
    return;
  }

  // 성공 → 중앙 스택에 추가
  centerStack.push(a.card);
  centerStack.push(b.card);

  // 플레이어 덱에서 제거
  player = player.filter(c => c.id !== a.card.id && c.id !== b.card.id);

  selected = [];
  render();

  setTimeout(aiAutoPlay, 600);
}

/* -----------------------------
   플레이어가 AI 카드 가져가기
------------------------------ */
function stealFromAI(card) {
  ai = ai.filter(c => c.id !== card.id);
  player.push(card);

  lastPlayerStealTime = Date.now();
  render();
}

/* -----------------------------
   5초 뒤 AI가 플레이어 카드 훔침
------------------------------ */
setInterval(() => {
  if (!lastPlayerStealTime) return;
  if (Date.now() - lastPlayerStealTime >= 5000) {
    aiStealFromPlayer();
    lastPlayerStealTime = null;
  }
}, 500);

/* -----------------------------
   AI가 플레이어 카드 1장 훔치기
------------------------------ */
function aiStealFromPlayer() {
  if (player.length === 0) return;

  const idx = Math.floor(Math.random() * player.length);
  const card = player[idx];

  player.splice(idx, 1);
  ai.push(card);

  aiAutoPlay();
  render();
}

/* -----------------------------
   AI 자동 플레이 (짝이 되면 낸다)
------------------------------ */
function aiAutoPlay() {
  const groups = {};

  ai.forEach(c => {
    if (c.isJoker) return;
    if (!groups[c.num]) groups[c.num] = [];
    groups[c.num].push(c);
  });

  for (let num in groups) {
    if (groups[num].length >= 2) {
      const a = groups[num][0];
      const b = groups[num][1];

      ai = ai.filter(c => c.id !== a.id && c.id !== b.id);

      centerStack.push(a);
      centerStack.push(b);

      render();
      return;
    }
  }
}

render();
</script>
</body>
</html>
